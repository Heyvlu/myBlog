# 1.跨域问题

​		首先前后端交互不可避免的就会遇到跨域问题，我司现在全是用 `cors`来解决的，如果你司后端嫌麻烦不肯配置的话，dev环境也可以通过 `webpack-dev-server`的`proxy`来解决，开发环境用`nginx`反代理一下就好了，具体配置这里就不展开了。

# 2.登陆权限

## 登录

​		当用户填写完账号和密码后向服务端验证是否正确，验证通过之后，服务端会返回一个**token**，拿到token之后（我会将这个token存贮到cookie中，保证刷新页面后能记住用户登录状态），前端会根据token再去拉取一个 **user_info** 的接口来获取用户的详细信息（如用户权限，用户名等等信息）。

​		为了保证安全性，我司现在后台所有token**有效期**(Expires/Max-Age)都是**Session**，就是当浏览器关闭了就丢失了。重新打开游览器都需要重新登录验证，后端也会在每周固定一个时间点重新刷新token，让后台用户全部重新登录一次，确保后台用户不会因为电脑遗失或者其它原因被人随意使用账号。

## 获取用户信息

​		用户登录成功之后，我们会在全局钩子`router.beforeEach`中拦截路由，判断是否已获得token，在获得token之后我们就要去获取用户的基本信息了。

<img src="C:\Users\30599\AppData\Roaming\Typora\typora-user-images\image-20220219215506024.png" alt="image-20220219215506024"  />

![image-20220219215651482](C:\Users\30599\AppData\Roaming\Typora\typora-user-images\image-20220219215651482.png)

## 权限验证

​		通过token获取用户对应的 **role**，动态根据用户的 role 算出其对应有权限的路由，通过 **router.addRoutes** 动态挂载这些路由。

​	（不同的权限对应着不同的路由，同时侧边栏也需根据不同的权限，异步生成。

### 具体实现

![image-20220219221136406](C:\Users\30599\AppData\Roaming\Typora\typora-user-images\image-20220219221136406.png)



![image-20220219221923780](C:\Users\30599\AppData\Roaming\Typora\typora-user-images\image-20220219221923780.png)































